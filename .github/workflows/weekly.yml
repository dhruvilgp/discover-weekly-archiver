name: Save Discover Weekly

on:
  schedule:
    # Runs every Monday at 09:00 UTC (adjust to your timezone preference)
    - cron: '0 9 * * 1'
  
  # Allows manual triggering from GitHub Actions tab
  workflow_dispatch:

jobs:
  archive-playlist:
    runs-on: ubuntu-latest
    
    steps:
      - name: üì• Checkout repository
        uses: actions/checkout@v4
      
      - name: üêç Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'
      
      - name: üì¶ Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      
      - name: üéµ Archive Discover Weekly
        run: python main.py
        env:
          SPOTIPY_CLIENT_ID: ${{ secrets.SPOTIPY_CLIENT_ID }}
          SPOTIPY_CLIENT_SECRET: ${{ secrets.SPOTIPY_CLIENT_SECRET }}
          SPOTIPY_REDIRECT_URI: ${{ secrets.SPOTIPY_REDIRECT_URI }}
          SPOTIPY_REFRESH_TOKEN: ${{ secrets.SPOTIPY_REFRESH_TOKEN }}
      
      - name: ‚úÖ Report Success
        if: success()
        run: |
          echo "‚úÖ Successfully archived Discover Weekly playlist!"
          echo "Check your Spotify account for the new playlist."
      
      - name: ‚ùå Report Failure
        if: failure()
        run: |
          echo "‚ùå Failed to archive Discover Weekly playlist."
          echo "Check the logs above for error details."
